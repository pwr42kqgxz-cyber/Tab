<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Tablature</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  touch-action: none;
  font-family: serif;
  background: white;
}

#canvas {
  position: relative;
  height: 70vh;
  touch-action: none;
}

.line {
  position: absolute;
  left: 5%;
  right: 5%;
  height: 1px;
  background: black;
}

.symbol {
  position: absolute;
  font-size: 22px;
  user-select: none;
  touch-action: none;
}

#palette {
  height: 30vh;
  overflow: auto;
  border-top: 1px solid black;
  padding: 8px;
  display: flex;
  flex-wrap: wrap;
}
.palette-item {
  border: 1px solid black;
  padding: 6px;
  margin: 4px;
  font-size: 20px;
}
</style>
</head>
<body>

<div id="canvas"></div>
<div id="palette"></div>

<script>
const canvas = document.getElementById("canvas");

// lignes
for (let i = 0; i < 6; i++) {
  const line = document.createElement("div");
  line.className = "line";
  line.style.top = (60 + i * 40) + "px";
  canvas.appendChild(line);
}

// palette
const symbols = [
  "a","b","c","d","e","f","g","h","j","k",
  "/a","//a","///a",
  "1","2","3","4","5","6","7","|"
];

const palette = document.getElementById("palette");
let selected = null;

symbols.forEach(sym => {
  const btn = document.createElement("div");
  btn.className = "palette-item";
  btn.textContent = sym;
  btn.addEventListener("touchstart", e => {
    e.preventDefault();
    selected = sym;
  }, { passive: false });
  palette.appendChild(btn);
});

// insertion
canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  if (!selected) return;

  const touch = e.touches[0];
  const rect = canvas.getBoundingClientRect();

  const s = document.createElement("div");
  s.className = "symbol";
  s.textContent = selected;
  s.style.left = (touch.clientX - rect.left) + "px";
  s.style.top = (touch.clientY - rect.top) + "px";

  let startX, startY, offsetX, offsetY, pressTimer;

  s.addEventListener("touchstart", ev => {
    ev.preventDefault();
    const t = ev.touches[0];
    startX = t.clientX;
    startY = t.clientY;
    offsetX = s.offsetLeft;
    offsetY = s.offsetTop;

    pressTimer = setTimeout(() => s.remove(), 600);
  }, { passive: false });

  s.addEventListener("touchmove", ev => {
    ev.preventDefault();
    clearTimeout(pressTimer);
    const t = ev.touches[0];
    s.style.left = (offsetX + t.clientX - startX) + "px";
    s.style.top = (offsetY + t.clientY - startY) + "px";
  }, { passive: false });

  s.addEventListener("touchend", () => {
    clearTimeout(pressTimer);
  });

  canvas.appendChild(s);
}, { passive: false });
</script>

</body>
</html>
